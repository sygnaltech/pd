{
  "version": 3,
  "sources": ["../../src/services/booking/timely.ts", "../../src/util.ts", "../../src/page/services.ts"],
  "sourcesContent": ["import { Page } from \"@sygnal/sse\";\n\n\n\n// declare function timelyButton(company: string, options: object): void;\ndeclare class timelyButton {\n  constructor(company: string, options: object);\n  start(): void;\n}\n\n\nexport class TimelyService {\n\n  account: string;\n  defaultLocationId?: string; // 247844  \n  defaultStaffId?: string;\n  defaultCategoryId?: string;\n  defaultServiceId?: string;\n\n  constructor(account: string) {\n\n    this.account = account; \n\n  }\n  \n  async init() {\n\n    // console.log(\"adding timely script\")\n    // await this.loadTimelyScript(); \n\n// Page.loadScript(\"//book.gettimely.com/widget/book-button-v1.5.js\"); \n\n  }\n\n// <script>new timelyButton(\"ponsonbydoctors\", {\"location\":\"244540\",\"category\":\"397934\",\"product\":\"3250333:SV\",\"staff\":\"424054\",\"style\":\"dark\"});</script>\n\n  bookService(categoryId: string | null, serviceId: string | null) {\n    const bookingButton = new timelyButton(\n      this.account, {\n        location: this.defaultLocationId,\n        staff: this.defaultStaffId, \n        category: categoryId,\n        product: serviceId,\n        dontCreateButton: true\n    });\n\n    bookingButton.start();\n  }\n\n//   static loadTimelyScript(): Promise<void> {\n\n//     // Check to see if it exists? install only if needed? \n\n\n\n//     return new Promise((resolve, reject) => {\n//       const script = document.createElement('script');\n// //      script.src = \"//book.gettimely.com/widget/book-button-v1.3.js\";\n//       script.src = \"//book.gettimely.com/widget/book-button-v1.5.js\";  \n//       script.id = 'timelyScript';\n//       script.onload = () => resolve();\n//       script.onerror = () => reject(new Error(`Failed to load script: ${script.src}`));\n//       document.head.appendChild(script);\n//     });\n//   }\n  \n}\n\n", "\n\n// Utility function to add event listeners to elements\nexport function addEventListeners(selector: string, event: string, handler: (e: Event) => void) {\n    const elements = document.querySelectorAll(selector);\n    elements.forEach(element => {\n      element.addEventListener(event, handler);\n    });\n  }\n\n  \n// Utility Functions\nexport function formatAsNumber(n: number | string): string {\n    if (Number(n) === 0) return \"-\";\n    return String(n);\n}\n  \nexport function formatAsCurrency(n: number | string): string {\n    if (Number(n) === 0) return \"-\";\n    const formatter = new Intl.NumberFormat('en-NZ', { style: 'currency', currency: 'NZD' });\n    return formatter.format(Number(n)) + \" NZD\";\n}\n\nexport function findAncestorWithAttribute(element: HTMLElement, attributeName: string): HTMLElement | null {\n    let currentElement: HTMLElement | null = element;\n\n    while (currentElement) {\n        if (currentElement.hasAttribute(attributeName)) {\n            return currentElement;\n        }\n        currentElement = currentElement.parentElement;\n    }\n\n    return null;\n}\n\nexport function getAncestorAttributeValue(element: HTMLElement, attributeName: string): string | null {\n    let currentElement: HTMLElement | null = element;\n\n    while (currentElement) {\n        if (currentElement.hasAttribute(attributeName)) {\n            return currentElement.getAttribute(attributeName);\n        }\n        currentElement = currentElement.parentElement;\n    }\n\n    return null;\n}\n\nexport function hasAncestorWithAttribute(element: HTMLElement, attributeName: string): boolean {\n    return findAncestorWithAttribute(element, attributeName) !== null;\n}\n\nexport function convertToPixels(value: string, contextElement: HTMLElement = document.documentElement): number {\n    // Parse the numeric value and unit, including negative values\n    const match = value.match(/^(-?\\d+\\.?\\d*)(rem|em|px|vh|vw|%)$/);\n    if (!match) throw new Error('Invalid value format');\n\n    const [, amountStr, unit] = match;\n    const amount = parseFloat(amountStr);\n\n    // Convert based on the unit\n    switch (unit) {\n        case 'px':\n            return amount;\n        case 'rem':\n            return amount * parseFloat(getComputedStyle(document.documentElement).fontSize);\n        case 'em':\n            // For 'em', it's relative to the font-size of the context element.\n            return amount * parseFloat(getComputedStyle(contextElement).fontSize);\n        case 'vh':\n            return amount * window.innerHeight / 100;\n        case 'vw':\n            return amount * window.innerWidth / 100;\n        case '%':\n            // For %, it's relative to the parent element's size. This can be tricky as it depends on the property (width, height, font-size, etc.).\n            // In this example, we'll use it relative to the width of the context element, but you might need to adjust based on your specific use case.\n            return amount * contextElement.clientWidth / 100;\n        default:\n            throw new Error('Unsupported unit');\n    }\n}\n\n\n/*\n// Example usage:\nconst pixelValue = convertToPixels(\"10vh\");\nconsole.log(pixelValue);\n*/\n\n", "\n/*\n * SITE \n * Page | Services \n * \n */\n\nimport { WindowData, Window } from \"../../types/global\";\nimport { TimelyService } from \"../services/booking/timely\";\nimport { addEventListeners } from \"../util\";\nimport { IRouteHandler, Page } from \"@sygnal/sse\";\n\n\ndeclare global {\n    interface Window {\n        data: WindowData;\n    }\n}\n\nexport class ServicesPage implements IRouteHandler {\n\n    timely: TimelyService;\n\n    constructor() {\n\n        this.timely = new TimelyService(\"ponsonbydoctors\"); \n\n    }\n\n    setup() {\n    }\n    \n    exec() {\n\n        // Timely script already loaded at Site level\n\n        if (!window.data) {\n            console.error (\"Window.data is not available.\");\n            return;\n        }\n\n        addEventListeners('*[timely=\"book\"]', 'click', (e: Event) => {\n            const target = e.currentTarget as HTMLElement;\n\n            this.timely.bookService(\n                target.getAttribute('categoryId'), \n                target.getAttribute('serviceId')\n            ); \n        });\n\n        addEventListeners('*[timely=\"ponsonby\"]', 'click', (e: Event) => {\n            const target = e.currentTarget as HTMLElement;\n\n            this.timely.bookService(\n                target.getAttribute('categoryId'), \n                target.getAttribute('serviceId')\n            ); \n        });\n        addEventListeners('*[timely=\"ponsonby-service\"]', 'click', (e: Event) => {\n            const target = e.currentTarget as HTMLElement;\n\n            this.timely.bookService(\n                target.getAttribute('categoryId'), \n                target.getAttribute('serviceId')\n            ); \n        });\n        addEventListeners('*[timely=\"online\"]', 'click', (e: Event) => {\n            const target = e.currentTarget as HTMLElement;\n\n            this.timely.bookService(\n                target.getAttribute('categoryId'), \n                target.getAttribute('serviceId')\n            ); \n        });\n        addEventListeners('*[timely=\"online-service\"]', 'click', (e: Event) => {\n            const target = e.currentTarget as HTMLElement;\n\n            this.timely.bookService(\n                target.getAttribute('categoryId'), \n                target.getAttribute('serviceId')\n            ); \n        });                \n  \n        // Auto-booking based on URL parameter\n        if (window.location.search.includes('action=book')) {\n\n            this.timely.bookService(\n                window.data.timely_categoryId, \n                window.data.timely_productId\n            ); \n\n        }\n\n    }\n\n}  \n\n    \n    \n    \n    "],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAWO,MAAM,gBAAN,MAAoB;AAAA,IAQzB,YAAY,SAAiB;AAE3B,WAAK,UAAU;AAAA,IAEjB;AAAA,IAEM,OAAO;AAAA;AAAA,MAOb;AAAA;AAAA,IAIA,YAAY,YAA2B,WAA0B;AAC/D,YAAM,gBAAgB,IAAI;AAAA,QACxB,KAAK;AAAA,QAAS;AAAA,UACZ,UAAU,KAAK;AAAA,UACf,OAAO,KAAK;AAAA,UACZ,UAAU;AAAA,UACV,SAAS;AAAA,UACT,kBAAkB;AAAA,QACtB;AAAA,MAAC;AAED,oBAAc,MAAM;AAAA,IACtB;AAAA,EAmBF;;;AC/DO,WAAS,kBAAkB,UAAkB,OAAe,SAA6B;AAC5F,UAAM,WAAW,SAAS,iBAAiB,QAAQ;AACnD,aAAS,QAAQ,aAAW;AAC1B,cAAQ,iBAAiB,OAAO,OAAO;AAAA,IACzC,CAAC;AAAA,EACH;;;ACWK,MAAM,eAAN,MAA4C;AAAA,IAI/C,cAAc;AAEV,WAAK,SAAS,IAAI,cAAc,iBAAiB;AAAA,IAErD;AAAA,IAEA,QAAQ;AAAA,IACR;AAAA,IAEA,OAAO;AAIH,UAAI,CAAC,OAAO,MAAM;AACd,gBAAQ,MAAO,+BAA+B;AAC9C;AAAA,MACJ;AAEA,wBAAkB,oBAAoB,SAAS,CAAC,MAAa;AACzD,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AAED,wBAAkB,wBAAwB,SAAS,CAAC,MAAa;AAC7D,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AACD,wBAAkB,gCAAgC,SAAS,CAAC,MAAa;AACrE,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AACD,wBAAkB,sBAAsB,SAAS,CAAC,MAAa;AAC3D,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AACD,wBAAkB,8BAA8B,SAAS,CAAC,MAAa;AACnE,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AAGD,UAAI,OAAO,SAAS,OAAO,SAAS,aAAa,GAAG;AAEhD,aAAK,OAAO;AAAA,UACR,OAAO,KAAK;AAAA,UACZ,OAAO,KAAK;AAAA,QAChB;AAAA,MAEJ;AAAA,IAEJ;AAAA,EAEJ;",
  "names": []
}
