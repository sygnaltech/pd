{
  "version": 3,
  "sources": ["../../src/services/booking/timely.ts", "../../src/util.ts", "../../src/page/services.ts"],
  "sourcesContent": ["import { Page } from \"@sygnal/sse\";\r\nimport { ScriptElement } from \"@sygnal/sse/dist/script\";\r\n\r\n\r\n\r\n// declare function timelyButton(company: string, options: object): void;\r\ndeclare class timelyButton {\r\n  constructor(company: string, options: object);\r\n  start(): void;\r\n}\r\n\r\n\r\nexport class TimelyService {\r\n\r\n  account: string;\r\n  defaultLocationId?: string; // 247844  \r\n  defaultStaffId?: string;\r\n  defaultCategoryId?: string;\r\n  defaultServiceId?: string;\r\n\r\n  constructor(account: string) {\r\n\r\n    this.account = account; \r\n\r\n  }\r\n  \r\n  async init() {\r\n\r\n    // console.log(\"adding timely script\")\r\n    // await this.loadTimelyScript(); \r\n\r\n    // Page.loadScript(\"//book.gettimely.com/widget/book-button-v1.5.js\"); \r\n    // Page.Head.loadScript(\"//book.gettimely.com/widget/book-button-v1.5.js\", { id: \"timelyScript\" });\r\n\r\n// Page.Body.loadScript()\r\n\r\n    // const timelyScript = new ScriptElement(\"//book.gettimely.com/widget/book-button-v1.5.js\");\r\n    // timelyScript.id = \"timelyScript\";\r\n    // timelyScript.appendTo('head');\r\n\r\n  }\r\n\r\n// <script>new timelyButton(\"ponsonbydoctors\", {\"location\":\"244540\",\"category\":\"397934\",\"product\":\"3250333:SV\",\"staff\":\"424054\",\"style\":\"dark\"});</script>\r\n\r\n  bookService(categoryId: string | null, serviceId: string | null) {\r\n    const bookingButton = new timelyButton(\r\n      this.account, {\r\n        location: this.defaultLocationId,\r\n        staff: this.defaultStaffId, \r\n        category: categoryId,\r\n        product: serviceId,\r\n        dontCreateButton: true\r\n    });\r\n\r\n    bookingButton.start();\r\n  }\r\n\r\n//   static loadTimelyScript(): Promise<void> {\r\n\r\n//     // Check to see if it exists? install only if needed? \r\n\r\n\r\n\r\n//     return new Promise((resolve, reject) => {\r\n//       const script = document.createElement('script');\r\n// //      script.src = \"//book.gettimely.com/widget/book-button-v1.3.js\";\r\n//       script.src = \"//book.gettimely.com/widget/book-button-v1.5.js\";  \r\n//       script.id = 'timelyScript';\r\n//       script.onload = () => resolve();\r\n//       script.onerror = () => reject(new Error(`Failed to load script: ${script.src}`));\r\n//       document.head.appendChild(script);\r\n//     });\r\n//   }\r\n  \r\n}\r\n\r\n", "\r\n\r\n// Utility function to add event listeners to elements\r\nexport function addEventListeners(selector: string, event: string, handler: (e: Event) => void) {\r\n    const elements = document.querySelectorAll(selector);\r\n    elements.forEach(element => {\r\n      element.addEventListener(event, handler);\r\n    });\r\n  }\r\n\r\n  \r\n// Utility Functions\r\nexport function formatAsNumber(n: number | string): string {\r\n    if (Number(n) === 0) return \"-\";\r\n    return String(n);\r\n}\r\n  \r\nexport function formatAsCurrency(n: number | string): string {\r\n    if (Number(n) === 0) return \"-\";\r\n    const formatter = new Intl.NumberFormat('en-NZ', { style: 'currency', currency: 'NZD' });\r\n    return formatter.format(Number(n)) + \" NZD\";\r\n}\r\n\r\nexport function findAncestorWithAttribute(element: HTMLElement, attributeName: string): HTMLElement | null {\r\n    let currentElement: HTMLElement | null = element;\r\n\r\n    while (currentElement) {\r\n        if (currentElement.hasAttribute(attributeName)) {\r\n            return currentElement;\r\n        }\r\n        currentElement = currentElement.parentElement;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function getAncestorAttributeValue(element: HTMLElement, attributeName: string): string | null {\r\n    let currentElement: HTMLElement | null = element;\r\n\r\n    while (currentElement) {\r\n        if (currentElement.hasAttribute(attributeName)) {\r\n            return currentElement.getAttribute(attributeName);\r\n        }\r\n        currentElement = currentElement.parentElement;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function hasAncestorWithAttribute(element: HTMLElement, attributeName: string): boolean {\r\n    return findAncestorWithAttribute(element, attributeName) !== null;\r\n}\r\n\r\nexport function convertToPixels(value: string, contextElement: HTMLElement = document.documentElement): number {\r\n    // Parse the numeric value and unit, including negative values\r\n    const match = value.match(/^(-?\\d+\\.?\\d*)(rem|em|px|vh|vw|%)$/);\r\n    if (!match) throw new Error('Invalid value format');\r\n\r\n    const [, amountStr, unit] = match;\r\n    const amount = parseFloat(amountStr);\r\n\r\n    // Convert based on the unit\r\n    switch (unit) {\r\n        case 'px':\r\n            return amount;\r\n        case 'rem':\r\n            return amount * parseFloat(getComputedStyle(document.documentElement).fontSize);\r\n        case 'em':\r\n            // For 'em', it's relative to the font-size of the context element.\r\n            return amount * parseFloat(getComputedStyle(contextElement).fontSize);\r\n        case 'vh':\r\n            return amount * window.innerHeight / 100;\r\n        case 'vw':\r\n            return amount * window.innerWidth / 100;\r\n        case '%':\r\n            // For %, it's relative to the parent element's size. This can be tricky as it depends on the property (width, height, font-size, etc.).\r\n            // In this example, we'll use it relative to the width of the context element, but you might need to adjust based on your specific use case.\r\n            return amount * contextElement.clientWidth / 100;\r\n        default:\r\n            throw new Error('Unsupported unit');\r\n    }\r\n}\r\n\r\n\r\n/*\r\n// Example usage:\r\nconst pixelValue = convertToPixels(\"10vh\");\r\nconsole.log(pixelValue);\r\n*/\r\n\r\n", "\r\n/*\r\n * SITE \r\n * Page | Services \r\n * \r\n */\r\n\r\nimport { WindowData, Window } from \"../../types/global\";\r\nimport { TimelyService } from \"../services/booking/timely\";\r\nimport { addEventListeners } from \"../util\";\r\nimport { IModule, Page } from \"@sygnal/sse\";\r\n\r\n\r\ndeclare global {\r\n    interface Window {\r\n        data: WindowData;\r\n    }\r\n}\r\n\r\nexport class ServicesPage implements IModule {\r\n\r\n    timely: TimelyService;\r\n\r\n    constructor() {\r\n\r\n        this.timely = new TimelyService(\"ponsonbydoctors\"); \r\n\r\n    }\r\n\r\n    setup() {\r\n    }\r\n    \r\n    exec() {\r\n\r\n        // Timely script already loaded at Site level\r\n\r\n        if (!window.data) {\r\n            console.error (\"Window.data is not available.\");\r\n            return;\r\n        }\r\n\r\n        addEventListeners('*[timely=\"book\"]', 'click', (e: Event) => {\r\n            const target = e.currentTarget as HTMLElement;\r\n\r\n            this.timely.bookService(\r\n                target.getAttribute('categoryId'), \r\n                target.getAttribute('serviceId')\r\n            ); \r\n        });\r\n\r\n        addEventListeners('*[timely=\"ponsonby\"]', 'click', (e: Event) => {\r\n            const target = e.currentTarget as HTMLElement;\r\n\r\n            this.timely.bookService(\r\n                target.getAttribute('categoryId'), \r\n                target.getAttribute('serviceId')\r\n            ); \r\n        });\r\n        addEventListeners('*[timely=\"ponsonby-service\"]', 'click', (e: Event) => {\r\n            const target = e.currentTarget as HTMLElement;\r\n\r\n            this.timely.bookService(\r\n                target.getAttribute('categoryId'), \r\n                target.getAttribute('serviceId')\r\n            ); \r\n        });\r\n        addEventListeners('*[timely=\"online\"]', 'click', (e: Event) => {\r\n            const target = e.currentTarget as HTMLElement;\r\n\r\n            this.timely.bookService(\r\n                target.getAttribute('categoryId'), \r\n                target.getAttribute('serviceId')\r\n            ); \r\n        });\r\n        addEventListeners('*[timely=\"online-service\"]', 'click', (e: Event) => {\r\n            const target = e.currentTarget as HTMLElement;\r\n\r\n            this.timely.bookService(\r\n                target.getAttribute('categoryId'), \r\n                target.getAttribute('serviceId')\r\n            ); \r\n        });                \r\n  \r\n        // Auto-booking based on URL parameter\r\n        if (window.location.search.includes('action=book')) {\r\n\r\n            this.timely.bookService(\r\n                window.data.timely_categoryId, \r\n                window.data.timely_productId\r\n            ); \r\n\r\n        }\r\n\r\n    }\r\n\r\n}  \r\n\r\n    \r\n    \r\n    \r\n    "],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAYO,MAAM,gBAAN,MAAoB;AAAA,IAQzB,YAAY,SAAiB;AAE3B,WAAK,UAAU;AAAA,IAEjB;AAAA,IAEM,OAAO;AAAA;AAAA,MAcb;AAAA;AAAA,IAIA,YAAY,YAA2B,WAA0B;AAC/D,YAAM,gBAAgB,IAAI;AAAA,QACxB,KAAK;AAAA,QAAS;AAAA,UACZ,UAAU,KAAK;AAAA,UACf,OAAO,KAAK;AAAA,UACZ,UAAU;AAAA,UACV,SAAS;AAAA,UACT,kBAAkB;AAAA,QACtB;AAAA,MAAC;AAED,oBAAc,MAAM;AAAA,IACtB;AAAA,EAmBF;;;ACvEO,WAAS,kBAAkB,UAAkB,OAAe,SAA6B;AAC5F,UAAM,WAAW,SAAS,iBAAiB,QAAQ;AACnD,aAAS,QAAQ,aAAW;AAC1B,cAAQ,iBAAiB,OAAO,OAAO;AAAA,IACzC,CAAC;AAAA,EACH;;;ACWK,MAAM,eAAN,MAAsC;AAAA,IAIzC,cAAc;AAEV,WAAK,SAAS,IAAI,cAAc,iBAAiB;AAAA,IAErD;AAAA,IAEA,QAAQ;AAAA,IACR;AAAA,IAEA,OAAO;AAIH,UAAI,CAAC,OAAO,MAAM;AACd,gBAAQ,MAAO,+BAA+B;AAC9C;AAAA,MACJ;AAEA,wBAAkB,oBAAoB,SAAS,CAAC,MAAa;AACzD,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AAED,wBAAkB,wBAAwB,SAAS,CAAC,MAAa;AAC7D,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AACD,wBAAkB,gCAAgC,SAAS,CAAC,MAAa;AACrE,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AACD,wBAAkB,sBAAsB,SAAS,CAAC,MAAa;AAC3D,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AACD,wBAAkB,8BAA8B,SAAS,CAAC,MAAa;AACnE,cAAM,SAAS,EAAE;AAEjB,aAAK,OAAO;AAAA,UACR,OAAO,aAAa,YAAY;AAAA,UAChC,OAAO,aAAa,WAAW;AAAA,QACnC;AAAA,MACJ,CAAC;AAGD,UAAI,OAAO,SAAS,OAAO,SAAS,aAAa,GAAG;AAEhD,aAAK,OAAO;AAAA,UACR,OAAO,KAAK;AAAA,UACZ,OAAO,KAAK;AAAA,QAChB;AAAA,MAEJ;AAAA,IAEJ;AAAA,EAEJ;",
  "names": []
}
